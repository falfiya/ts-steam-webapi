"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("node-fetch"));const r=e=>{const t=Buffer.from(e,"hex");if(t.toString("hex").toLowerCase()!==e.toLowerCase())throw new Error(`Could not parse '${e}' as hex!`);if(16!==t.byteLength)throw new Error("The API key should be a 32 character hex string or 16 bytes!");return e};const s=e=>`https://${e}`,a=s("steamcdn-a.akamaihd.net"),n=s("media.steampowered.com"),o=s("steamcommunity.com"),i=e=>`${e}/steamcommunity/public/images`,p=i(a),l=i(n),c=/^\d{17}$/;var _=Object.freeze({__proto__:null}),u=Object.freeze({__proto__:null});var d=Object.freeze({__proto__:null,opts_default:{include_appinfo:!1,include_played_free_games:!1,appids_filter:[],include_free_sub:!1,skip_unvetted_apps:!1}}),m=Object.freeze({__proto__:null,GetBadges:_,GetCommunityBadgeProgress:u,GetOwnedGames:d});const f={max_length:1/0,end_date:0,count:20,feeds:[],tags:[]};var h=Object.freeze({__proto__:null,opts_default:f}),y=Object.freeze({__proto__:null,GetNewsForApp:h}),v=Object.freeze({__proto__:null}),w=Object.freeze({__proto__:null});var G,g,$;!function(e){e[e.private=1]="private",e[e.friends_only=2]="friends_only",e[e.public=3]="public"}(G||(G={})),function(e){e[e.has_rich_presence=1]="has_rich_presence",e[e.in_joinable_game=2]="in_joinable_game",e[e.golden=4]="golden",e[e.remote_play_together=8]="remote_play_together",e[e.client_type_web=256]="client_type_web",e[e.client_type_mobile=512]="client_type_mobile",e[e.client_type_tenfoot=1024]="client_type_tenfoot",e[e.client_type_vr=2048]="client_type_vr",e[e.launch_type_gamepad=4096]="launch_type_gamepad",e[e.launch_type_compat_tool=8192]="launch_type_compat_tool"}(g||(g={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online",e[e.busy=2]="busy",e[e.away=3]="away",e[e.snooze=4]="snooze",e[e.looking_to_trade=5]="looking_to_trade",e[e.looking_to_play=6]="looking_to_play"}($||($={}));var b=Object.freeze({__proto__:null,avatar:(e,t,r,s)=>`${e}/avatars/${t}/${r}${s}.jpg`,get community_visibility_state(){return G},get persona_state_flags(){return g},get persona_state(){return $}}),S=Object.freeze({__proto__:null}),x=Object.freeze({__proto__:null,GetFriendList:v,GetPlayerBans:w,GetPlayerSummaries:b,GetUserGroupList:S}),P=Object.freeze({__proto__:null}),j=Object.freeze({__proto__:null}),O=Object.freeze({__proto__:null}),I=Object.freeze({__proto__:null}),U=Object.freeze({__proto__:null,GetGlobalAchievementPercentagesForApp:P,GetPlayerAchievements:j,GetSchemaForGame:O,GetUserStatsForGame:I});async function E(e,r,s,a){const n=`https://api.steampowered.com/${e}/${r}/${s}?${a}`,o=await t.default(n);if(200!==o.status){const e=new Error(L(await o.text()));throw e.name=`${o.status}, ${o.statusText}`,e}return o.json()}const z=/\n/g,A=/(?:<\/?pre>)|(?:<\/?\w+>(?=<|$))/g,F=/(?<=\/?\w+>[^>]*)<\/?\w+>/g,k=/^<\/?\w+>/,L=e=>e.replace(z,"").replace(A,"").replace(F,", ").replace(k,"");const B=/(?<=]);\s*var rgChangingGames/;async function N(e,t){var r=`steamid=${e}`;void 0!==t&&(r+=`&count=${t}`);const{response:s}=await this.api_call("IPlayerService","GetRecentlyPlayedGames","v1",r);if(void 0===s)throw new Error("GetRecentlyPlayedGames: response is undefined!");return s.games}async function C(e,t){var r=`steamid=${e}`;t&&(r+=function(e){var t="";const{include_appinfo:r,include_played_free_games:s,appids_filter:a,include_free_sub:n,skip_unvetted_apps:o}=e;return void 0!==r&&(t+=`&include_appinfo=${r}`),void 0!==s&&(t+=`&include_played_free_games=${s}`),void 0!==a&&(t+=`&appids_filter=${a.join(",")}`),void 0!==n&&(t+=`&include_free_sub=${n}`),void 0!==o&&(t+=`&skip_unvetted_apps=${o}`),t}(t));const{response:s}=await this.api_call("IPlayerService","GetOwnedGames","v1",r);if(void 0===s)throw new Error("GetOwnedGames: response is undefined!");return s.games}async function R(e){const t=`steamid=${e}`,{response:r}=await this.api_call("IPlayerService","GetSteamLevel","v1",t);if(void 0===r)throw new Error("GetSteamLevel: response is undefined!");return r.player_level}async function T(e){const t=`steamid=${e}`,{response:r}=await this.api_call("IPlayerService","GetBadges","v1",t);if(void 0===r)throw new Error("GetBadges: response is undefined!");return r}async function V(e){const t=`steamid=${e}`,{response:r}=await this.api_call("IPlayerService","GetCommunityBadgeProgress","v1",t);if(void 0===r)throw new Error("GetCommunityBadgeProgress: response is undefined!");return r.quests}async function q(e,t){var r=`appid=${e}`;void 0!==t&&(r+=function(e){var t="";const{max_length:r,end_date:s,count:a,feeds:n,tags:o}=e;return void 0!==r&&(t+=`&maxlength=${r}`),void 0!==s&&(t+=`&enddate=${s}`),void 0!==a&&(t+=`&count=${a}`),void 0!==n&&(t+=`&feeds=${n.join(",")}`),void 0!==o&&(t+=`&tags=${o.join(",")}`),t}(t));const{appnews:s}=await E("ISteamNews","GetNewsForApp","v2",r);if(null==s)throw new Error("GetNewsForApp: appnews is undefined!");return s.newsitems}async function D(e,t){var r=`steamid=${e}`;t&&(r+=`&relationship=${t}`);return(await this.api_call("ISteamUser","GetFriendList","v1",r)).friendslist.friends}async function J(e){const t=`steamids=${e.join(",")}`;return(await this.api_call("ISteamUser","GetPlayerBans","v1",t)).players}async function M(e){const t=`steamids=${e.join(",")}`,{response:r}=await this.api_call("ISteamUser","GetPlayerSummaries","v2",t);if(void 0===r)throw new Error("GetPlayerSummaries: response is undefined!");return r.players}async function H(e){const{response:t}=await this.api_call("ISteamUser","GetUserGroupList","v1",`steamid=${e}`);if(void 0===t)throw new Error("GetUserGroupList: response is undefined!");return t.groups}async function K(e){const{response:t}=await this.api_call("ISteamUser","ResolveVanityURL","v1",`vanityurl=${e}`);if(void 0===t)throw new Error("ResolveVanityUrl: response is undefined!");if(1!==t.success)throw new Error(`ResolveVanityUrl ${t.success}: ${t}`);return t.steamid}async function Q(e,t){const r=`steamid=${e}&appid=${t}`,{playerstats:s}=await this.api_call("ISteamUserStats","GetPlayerAchievements","v1",r);if(!s.success)throw new Error(`GetPlayerAchievements: ${s.error}`);return s}async function W(e,t){var r=`appid=${e}`;t&&(r+=`&l=${t}`);const{game:s}=await this.api_call("ISteamUserStats","GetSchemaForGame","v2",r);return s}async function X(e,t){const r=`steamid=${e}&appid=${t}`,{playerstats:s}=await this.api_call("ISteamUserStats","GetUserStatsForGame","v2",r);if(void 0===s)throw new Error("GetUserStatsForGame: playerstats is undefined!");return s}exports.GetGlobalAchievementPercentagesForApp=async function(e){const t=`gameid=${e}`,{response:r}=await E("ISteamUserStats","GetGlobalAchievementPercentagesForApp","v2",t);if(void 0===r)throw new Error("GetGlobalAchievementPercentagesForApp: response is undefined!");return r.achievementpercentages.achievements},exports.GetNumberOfCurrentPlayers=async function(e){const{response:t}=await E("ISteamUserStats","GetNumberOfCurrentPlayers","v1",`appid=${e}`);if(void 0===t)throw new Error("GetNumberOfCurrentPlayers: response is undefined!");return t},exports.GetScrapedGames=async function(e){const r=await t.default(`${e}/games/?tab=all`).then((e=>e.text())),s=r.indexOf("var rgGames = ")+"var rgGames = ".length,a=r.search(B),n=r.slice(s,a);return JSON.parse(n)},exports.IPlayerService=m,exports.ISteamNews=y,exports.ISteamUser=x,exports.ISteamUserStats=U,exports.api_key=r,exports.app_id=e=>e,exports.app_image=(e,t,r)=>`${e}/apps/${t}/${r}.jpg`,exports.float=e=>e,exports.from_date=e=>e.getTime()/1e3,exports.h_media_steampowered=n,exports.h_steamcdn_akamihd=a,exports.h_steamcommunity=o,exports.ih_media_steampowered=l,exports.ih_steamcdn_akamihd=p,exports.image_host=i,exports.int=function(e){if(Number.isInteger(e))return e;throw new TypeError(`${e} is not an int!`)},exports.minutes=e=>e,exports.steam_id=e=>{if(c.test(e))return e;throw new Error("A Steam ID must be a string of 17 digits!")},exports.steam_session=class{constructor(e){this.GetRecentlyPlayedGames=N,this.GetOwnedGames=C,this.GetSteamLevel=R,this.GetBadges=T,this.GetCommunityBadgeProgress=V,this.GetNewsForApp=q,this.GetFriendList=D,this.GetPlayerBans=J,this.GetPlayerSummaries=M,this.GetUserGroupList=H,this.ResolveVanityURL=K,this.GetPlayerAchievements=Q,this.GetSchemaForGame=W,this.GetUserStatsForGame=X,this.key=r(e)}api_call(e,t,r,s){return E(e,t,r,`key=${this.key}&${s}`)}},exports.to_date=e=>new Date(1e3*e),exports.uint=function(e){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${e} is not a uint!`)};
